<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Convert Now – Markdown ↔ HTML</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turndown/dist/turndown.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .gradient-bg {
      background: #3b82f6;
    }
    
    .card-shadow {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .input-focus {
      transition: all 0.3s ease;
    }
    
    .input-focus:focus {
      box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.3);
    }
    
    .tab-active {
      background-color: white;
      color: #1e40af;
    }
    
    .copy-success {
      animation: fadeOut 2s forwards;
    }
    
    @keyframes fadeOut {
      0% { opacity: 1; }
      70% { opacity: 1; }
      100% { opacity: 0; }
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .teal-glow {
      box-shadow: 0 0 15px rgba(45, 212, 191, 0.5);
    }
  </style>
</head>
<body class="gradient-bg text-white min-h-screen flex flex-col">
  <!-- Top Nav -->
  <div class="absolute top-4 left-4 z-10">
    <a href="/" class="bg-teal-300 text-blue-800 font-semibold px-4 py-2 rounded-xl shadow-md hover:shadow-lg transition-all flex items-center gap-2 hover:scale-105">
      <i class="fas fa-arrow-left"></i>
      <span>Back</span>
    </a>
  </div>

  <!-- Main Container -->
  <div class="max-w-6xl mx-auto mt-20 px-6 flex-grow">
    <!-- Title -->
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        <span class="text-teal-300">Marky</span> - Markdown <span class="text-teal-300">↔</span> HTML Converter
      </h1>
      <p class="text-blue-100 max-w-2xl mx-auto text-lg">
        Convert between Markdown and HTML formats instantly. Perfect for developers, writers, and content creators.
      </p>
    </div>

    <!-- Conversion Direction Selector -->
    <div class="mb-10 flex justify-center">
      <div class="glass-effect rounded-2xl p-2 flex items-center card-shadow">
        <label for="convertDirection" class="block text-lg font-semibold mr-4 text-white">Convert from</label>
        <select id="convertDirection" class="bg-white text-blue-800 text-base rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-300 w-64 input-focus">
          <option value="auto" selected>Auto Detect</option>
          <option value="md-to-html">Markdown → HTML</option>
          <option value="html-to-md">HTML → Markdown</option>
        </select>
      </div>
    </div>

    <!-- Converter UI -->
    <div class="grid md:grid-cols-2 gap-8 mb-8">
      <!-- Input Panel -->
      <div class="flex flex-col glass-effect p-6 rounded-2xl card-shadow">
        <div class="flex justify-between items-center mb-4">
          <div>
            <label class="text-xl font-semibold text-white">Input</label>
            <div id="inputType" class="text-teal-200 text-sm mt-1">Markdown</div>
          </div>
          <div class="flex items-center gap-2">
            <!-- File Upload Button -->
            <label class="cursor-pointer bg-white/20 hover:bg-white/30 text-white px-3 py-2 rounded-xl transition-all flex items-center gap-2 text-sm font-semibold">
              <i class="fas fa-upload"></i>
              <span>Upload</span>
              <input type="file" id="fileUpload" accept=".md,.html,.htm,.txt" class="hidden">
            </label>
            <div class="flex space-x-1 text-sm font-semibold text-blue-800 bg-teal-200 rounded-xl p-1">
              <button id="showCode" class="px-4 py-2 rounded-xl tab-active transition-all">
                <i class="fas fa-code mr-1"></i>Code
              </button>
              <button id="showPreview" class="px-4 py-2 rounded-xl hover:bg-white/50 transition-all">
                <i class="fas fa-eye mr-1"></i>Preview
              </button>
            </div>
          </div>
        </div>
        
        <!-- Input Textarea -->
        <textarea id="markdown" placeholder="Type or paste your Markdown here..." class="p-4 rounded-xl text-base h-80 resize-none text-blue-900 bg-white focus:outline-none input-focus"></textarea>

        <!-- Rendered Preview (Hidden by Default) -->
        <div id="preview" class="p-4 rounded-xl text-base h-80 overflow-auto text-blue-900 bg-white hidden prose max-w-none"></div>
      </div>

      <!-- Output Panel -->
      <div class="flex flex-col glass-effect p-6 rounded-2xl card-shadow">
        <div class="flex justify-between items-center mb-4">
          <div>
            <label class="text-xl font-semibold text-white">Output</label>
            <div id="outputType" class="text-teal-200 text-sm mt-1">HTML</div>
          </div>
          <div class="flex items-center">
            <span id="copySuccess" class="text-teal-300 text-sm mr-3 hidden copy-success">
              <i class="fas fa-check mr-1"></i>Copied!
            </span>
            <button id="copyOutputBtn" class="text-blue-800 bg-teal-300 hover:bg-teal-200 px-4 py-2 rounded-xl transition-all flex items-center gap-2 hover:teal-glow">
              <i class="fas fa-copy"></i>
              <span>Copy</span>
            </button>
          </div>
        </div>
        <textarea id="html" placeholder="Your converted code will appear here..." readonly class="p-4 rounded-xl text-base h-80 resize-none text-blue-900 bg-white focus:outline-none input-focus"></textarea>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="flex flex-wrap justify-center gap-6 mt-8">
      <button id="downloadHtml" class="bg-gradient-to-r from-blue-400 to-teal-300 text-blue-800 font-bold px-8 py-4 rounded-full hover:scale-105 transition-all shadow-lg flex items-center gap-2 pulse-animation">
        <i class="fas fa-download"></i>
        <span>Download HTML</span>
      </button>
      <button id="downloadMd" class="bg-gradient-to-r from-teal-300 to-blue-400 text-blue-800 font-bold px-8 py-4 rounded-full hover:scale-105 transition-all shadow-lg flex items-center gap-2">
        <i class="fas fa-download"></i>
        <span>Download Markdown</span>
      </button>
      <button id="clearBtn" class="bg-transparent text-white border-2 border-teal-300 font-semibold px-8 py-4 rounded-full hover:bg-teal-300/10 transition-all flex items-center gap-2">
        <i class="fas fa-eraser"></i>
        <span>Clear All</span>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-teal-300 px-4 py-8 w-full mt-16">
    <div class="text-center text-blue-800 px-4 max-w-7xl mx-auto">
      <p class="flex flex-col md:flex-row justify-center items-center gap-2">
        <span>Made with <i class="fas fa-heart text-red-500 mx-1"></i> by <a href="https://julyw.com" class="text-blue-800 font-semibold hover:underline">July Wu</a>.</span>
        <span>This project is <a href="https://github.com/JLW-7/convert-md---html" class="text-blue-800 font-semibold hover:underline">open source</a> - give it a <i class="fas fa-star text-yellow-500 mx-1"></i> and contribute!</span>
      </p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const convertDirection = document.getElementById('convertDirection');
      const markdownInput = document.getElementById('markdown');
      const htmlOutput = document.getElementById('html');
      const previewDiv = document.getElementById('preview');
      const showCodeBtn = document.getElementById('showCode');
      const showPreviewBtn = document.getElementById('showPreview');
      const copyOutputBtn = document.getElementById('copyOutputBtn');
      const copySuccess = document.getElementById('copySuccess');
      const clearBtn = document.getElementById('clearBtn');
      const downloadHtmlBtn = document.getElementById('downloadHtml');
      const downloadMdBtn = document.getElementById('downloadMd');
      const inputType = document.getElementById('inputType');
      const outputType = document.getElementById('outputType');
      const fileUpload = document.getElementById('fileUpload');
      
      // Initialize
      updateConversionLabels();
      
      // Event Listeners
      convertDirection.addEventListener('change', function() {
        updateConversionLabels();
        convertContent();
      });
      
      markdownInput.addEventListener('input', convertContent);
      
      showCodeBtn.addEventListener('click', function() {
        showCodeBtn.classList.add('tab-active');
        showPreviewBtn.classList.remove('tab-active');
        markdownInput.classList.remove('hidden');
        previewDiv.classList.add('hidden');
      });
      
      showPreviewBtn.addEventListener('click', function() {
        showPreviewBtn.classList.add('tab-active');
        showCodeBtn.classList.remove('tab-active');
        markdownInput.classList.add('hidden');
        previewDiv.classList.remove('hidden');
        updatePreview();
      });
      
      copyOutputBtn.addEventListener('click', function() {
        if (htmlOutput.value.trim() !== '') {
          htmlOutput.select();
          document.execCommand('copy');
          copySuccess.classList.remove('hidden');
          setTimeout(() => {
            copySuccess.classList.add('hidden');
          }, 2000);
        }
      });
      
      clearBtn.addEventListener('click', function() {
        markdownInput.value = '';
        htmlOutput.value = '';
        previewDiv.innerHTML = '';
        fileUpload.value = ''; // Reset file input
      });
      
      // File Upload Handler
      fileUpload.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const fileName = file.name.toLowerCase();
        const reader = new FileReader();
        
        reader.onload = function(event) {
          const content = event.target.result;
          
          // Auto-detect file type and set conversion direction
          if (fileName.endsWith('.html') || fileName.endsWith('.htm')) {
            // HTML file uploaded - switch to HTML to Markdown mode
            convertDirection.value = 'html-to-md';
            updateConversionLabels();
          } else if (fileName.endsWith('.md') || fileName.endsWith('.markdown')) {
            // Markdown file uploaded - switch to Markdown to HTML mode
            convertDirection.value = 'md-to-html';
            updateConversionLabels();
          }
          // For .txt files, keep the current conversion direction
          
          // Set the content and trigger conversion
          markdownInput.value = content;
          convertContent();
          
          // Ensure we're showing the code view
          showCodeBtn.classList.add('tab-active');
          showPreviewBtn.classList.remove('tab-active');
          markdownInput.classList.remove('hidden');
          previewDiv.classList.add('hidden');
        };
        
        reader.onerror = function() {
          alert('Error reading file. Please try again.');
        };
        
        reader.readAsText(file);
      });
      
      downloadHtmlBtn.addEventListener('click', function() {
        if (htmlOutput.value.trim() !== '') {
          const blob = new Blob([htmlOutput.value], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'converted.html';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });
      
      downloadMdBtn.addEventListener('click', function() {
        if (markdownInput.value.trim() !== '') {
          const blob = new Blob([markdownInput.value], { type: 'text/markdown' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'converted.md';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });
      
      // Functions
      function updateConversionLabels() {
        if (convertDirection.value === 'auto') {
          inputType.textContent = 'Auto Detect';
          outputType.textContent = 'Auto';
          markdownInput.placeholder = 'Type or paste your Markdown or HTML here...';
        } else if (convertDirection.value === 'md-to-html') {
          inputType.textContent = 'Markdown';
          outputType.textContent = 'HTML';
          markdownInput.placeholder = 'Type or paste your Markdown here...';
        } else {
          inputType.textContent = 'HTML';
          outputType.textContent = 'Markdown';
          markdownInput.placeholder = 'Type or paste your HTML here...';
        }
      }
      
      // Detect if content is HTML
      function isHTML(content) {
        if (!content || content.trim() === '') return false;
        const trimmed = content.trim();
        // Check for common HTML patterns
        const htmlPatterns = [
          /^<!DOCTYPE\s+html/i,
          /^<html[\s>]/i,
          /^<head[\s>]/i,
          /^<body[\s>]/i,
          /^<div[\s>]/i,
          /^<p[\s>]/i,
          /^<span[\s>]/i,
          /^<h[1-6][\s>]/i,
          /^<(ul|ol|li)[\s>]/i,
          /^<(table|tr|td|th)[\s>]/i,
          /^<(a|img|br|hr)[\s>\/]/i,
          /^<(strong|em|b|i|u)[\s>]/i,
          /^<(section|article|header|footer|nav|main|aside)[\s>]/i
        ];
        
        // Check if content starts with an HTML tag pattern
        for (const pattern of htmlPatterns) {
          if (pattern.test(trimmed)) return true;
        }
        
        // Check for significant HTML tag presence in content
        const tagCount = (content.match(/<[a-z][a-z0-9]*[\s>\/]/gi) || []).length;
        const closingTagCount = (content.match(/<\/[a-z][a-z0-9]*>/gi) || []).length;
        
        // If there are multiple HTML tags, likely HTML content
        if (tagCount >= 2 && closingTagCount >= 1) return true;
        
        return false;
      }
      
      // Get the effective conversion direction (handles auto mode)
      function getEffectiveDirection() {
        if (convertDirection.value === 'auto') {
          return isHTML(markdownInput.value) ? 'html-to-md' : 'md-to-html';
        }
        return convertDirection.value;
      }
      
      function convertContent() {
        const effectiveDirection = getEffectiveDirection();
        
        // Update labels dynamically in auto mode
        if (convertDirection.value === 'auto') {
          if (effectiveDirection === 'md-to-html') {
            inputType.textContent = 'Detected: Markdown';
            outputType.textContent = 'HTML';
          } else {
            inputType.textContent = 'Detected: HTML';
            outputType.textContent = 'Markdown';
          }
        }
        
        if (effectiveDirection === 'md-to-html') {
          // Markdown to HTML conversion
          htmlOutput.value = marked.parse(markdownInput.value);
        } else {
          // HTML to Markdown conversion
          const turndownService = new TurndownService();
          htmlOutput.value = turndownService.turndown(markdownInput.value);
        }
        
        // Update preview if it's visible
        if (!previewDiv.classList.contains('hidden')) {
          updatePreview();
        }
      }
      
      function updatePreview() {
        const effectiveDirection = getEffectiveDirection();
        
        if (effectiveDirection === 'md-to-html') {
          previewDiv.innerHTML = marked.parse(markdownInput.value);
        } else {
          // For HTML to Markdown, we'll show the HTML preview
          previewDiv.innerHTML = markdownInput.value;
        }
      }
    });
  </script>
</body>
</html>
